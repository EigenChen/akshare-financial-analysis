# AKShare 财务分析工具 - 上市公司年报数据分析

## 📋 项目简介

基于 AKShare 的上市公司财务分析工具，支持 A 股和港股财务数据获取、分析和可视化。提供完整的财务分析报告生成、Web 交互界面、年报 PDF 下载等功能。

## ✨ 主要功能

### 📊 财务分析
- **9 个财务分析 Sheet**：营收基本数据、费用构成、增长率、资产负债、WC 分析、固定资产投入分析、收益率和杜邦分析、资产周转、人均数据
- **支持 A 股和港股**：完整的财务分析功能，支持两种市场
- **Excel 报告生成**：自动生成包含所有分析结果的 Excel 文件

### 🌐 Web 交互界面
- **统一财务工具**：集成 A 股和港股财务分析、报表下载、员工数量提取的一站式界面
- **Streamlit Web 应用**：友好的图形界面，无需编程即可使用
- **数据可视化**：支持趋势图表、多指标对比
- **结果管理**：支持加载已有结果、Excel 文件下载
- **报表预览功能**：支持按年份和报表类型（资产负债表/利润表/现金流量表）实时预览

### 📄 年报和报表处理
- **年报 PDF 下载**：支持从巨潮资讯网等渠道下载年报
- **财务报表下载**：下载三大财务报表（资产负债表、利润表、现金流量表）并生成 Excel
  - **A 股和港股支持**：两种市场都支持完整的报表下载功能
  - **报表预览**：支持按年份和报表类型实时预览，无需下载即可查看
  - **中文科目名称**：港股报表显示中文科目名称，与 Excel 导出一致
  - **统一单位**：港股报表金额统一为亿元单位，便于对比分析
- **员工数量提取**：从年报 PDF 中自动提取员工数量信息

### 🏢 市场支持
- **A 股市场**：完整支持上交所、深交所股票
- **港股市场**：支持港股财务数据获取和分析
  - **数据单位**：金额统一为亿元单位（港币），便于分析对比
  - **中文显示**：报表科目显示中文名称，提升可读性
  - **完整适配**：与 A 股功能对齐，支持所有分析维度

## 🚀 快速开始

### 1. 环境准备

#### 安装 Python 依赖
```bash
pip install -r requirements.txt
```

#### 验证安装
```bash
python 01_基础学习_验证安装.py
```

### 2. 使用 Web 界面（推荐）

#### 统一财务工具（推荐）⭐
```bash
# Windows
启动统一财务工具.bat

# Linux/Mac
streamlit run 统一财务工具.py
```

**统一财务工具**集成了所有功能：
- 📊 财务分析（A 股/港股）
- 📄 报表下载（支持预览）
- 👥 员工数量提取

#### 独立工具（可选）

**A 股财务分析**
```bash
# Windows
启动应用.bat

# Linux/Mac
streamlit run streamlit_app.py
```

**港股财务分析**
```bash
# Windows
启动港股应用.bat

# Linux/Mac
streamlit run streamlit_app_hk.py
```

**财务报表下载工具**
```bash
# Windows
启动财务报表工具.bat

# Linux/Mac
streamlit run 财务报表下载工具.py
```

浏览器会自动打开应用界面（通常是 `http://localhost:8501`）

### 3. 使用命令行脚本

#### A 股财务分析
```python
python 07_财务分析.py
```

#### 港股财务分析
```python
python hk_financial_analysis_full.py
```

## 📚 功能模块

### 基础学习（入门）

1. **01_基础学习_验证安装.py** - 验证 AKShare 是否正确安装
2. **02_基础学习_获取股票列表.py** - 学习如何获取上市公司列表
3. **03_基础学习_获取财务数据.py** - 学习如何获取财务指标
4. **04_基础学习_获取年报数据.py** - 学习如何获取年报数据
5. **05_实战_年报数据收集.py** - 实战：批量获取年报数据
6. **06_格式化显示财务数据.py** - 格式化显示财务数据

### 核心功能

#### 财务分析
- **07_财务分析.py** - A 股完整财务分析（9 个 Sheet）
- **hk_financial_analysis_full.py** - 港股完整财务分析（9 个 Sheet）
- **hk_financial_adapter.py** - 港股数据适配层

#### Web 界面
- **统一财务工具.py** - 统一财务工具（集成所有功能，推荐使用）⭐
- **streamlit_app.py** - A 股财务分析 Web 界面
- **streamlit_app_hk.py** - 港股财务分析 Web 界面

#### 年报和报表处理
- **08_下载年报PDF.py** - 年报 PDF 下载工具
- **财务报表下载工具.py** - 财务报表下载工具（Streamlit 版本，下载三大报表）
- **测试_从年报提取员工数量.py** - A 股年报员工数量提取
- **港股_从年报提取员工数量.py** - 港股年报员工数量提取

## 📖 详细文档

### 使用说明
- **[STREAMLIT_使用说明.md](STREAMLIT_使用说明.md)** - Streamlit Web 界面使用说明（A 股）
- **[港股财务分析工具使用说明.md](港股财务分析工具使用说明.md)** - 港股财务分析工具使用说明
- **[快速开始.md](快速开始.md)** - 快速开始指南
- **[学习指南.md](学习指南.md)** - 学习路径指南

### 技术文档
- **[接口使用说明.md](接口使用说明.md)** - AKShare 接口使用说明
- **[港股财务分析实现总结.md](港股财务分析实现总结.md)** - 港股功能实现总结
- **[港股员工数据获取说明.md](港股员工数据获取说明.md)** - 港股员工数据获取方法
- **[提示词.md](提示词.md)** - 项目开发提示词

## 🎯 使用示例

### 示例 1：A 股财务分析

```python
# 使用命令行
python 07_财务分析.py

# 或使用 Web 界面
启动应用.bat
```

### 示例 2：港股财务分析

```python
# 使用命令行
python hk_financial_analysis_full.py

# 或使用 Web 界面
启动港股应用.bat
```

### 示例 3：财务报表下载

```bash
# 使用统一财务工具（推荐）
启动统一财务工具.bat
# 选择"报表下载"功能，支持A股和港股

# 或使用独立工具
启动财务报表工具.bat
```

**功能特点**：
- ✅ 支持按年份和报表类型实时预览
- ✅ 港股报表显示中文科目名称
- ✅ 港股金额统一为亿元单位
- ✅ 一键下载 Excel 文件

### 示例 4：从年报提取员工数量

```python
from 港股_从年报提取员工数量 import extract_employee_count_by_year_from_pdfs

# 提取员工数量
results = extract_employee_count_by_year_from_pdfs(
    "年报PDF", "00700", 2020, 2024
)

# 查看结果
for year, count in results.items():
    if count:
        print(f"{year}年: {count:,} 人")
```

## 📁 项目结构

```
.
├── 01-05_基础学习脚本/          # 基础学习脚本
├── 07_财务分析.py               # A股财务分析主脚本
├── hk_financial_analysis_full.py # 港股财务分析主脚本
├── 统一财务工具.py              # 统一财务工具（集成所有功能）⭐
├── streamlit_app.py             # A股Web界面
├── streamlit_app_hk.py          # 港股Web界面
├── hk_financial_adapter.py      # 港股适配层
├── 08_下载年报PDF.py            # 年报PDF下载工具
├── 财务报表下载工具.py          # 财务报表下载工具（Streamlit）
├── 港股_从年报提取员工数量.py    # 港股员工数量提取
├── 启动统一财务工具.bat          # 启动统一财务工具
├── output/                      # 输出目录（Excel文件）
├── 年报PDF/                     # 年报PDF存储目录
├── requirements.txt             # Python依赖
└── README.md                    # 本文件
```

## ⚙️ 配置说明

### 数据单位
- **A 股**：人民币（CNY）
- **港股**：港币（HKD），不进行货币转换

### 输出文件
- Excel 文件保存在 `output/` 目录
- 文件名格式：`{公司名称}_{起始年}-{结束年}_财务分析_{时间戳}.xlsx`

### 员工数量数据
- 支持从年报 PDF 中提取
- 支持手动提供 CSV 文件
- CSV 格式：`年份,员工数量`

## ⚠️ 注意事项

- **数据来源**：AKShare 数据来源于公开数据源，仅用于学术研究
- **法律法规**：请遵守相关法律法规，注意商业风险
- **频率限制**：数据获取可能有频率限制，建议适当添加延时
- **数据准确性**：数据仅供参考，投资决策请以官方公告为准
- **港股数据**：港股数据单位为港币，不进行货币转换

## 🔧 常见问题

### Q1: 如何获取员工数量数据？
A: 有两种方式：
1. 从年报 PDF 中提取（推荐，可获取多年数据）
2. 通过接口获取（仅最新一年）

详细说明请参考：[港股员工数据获取说明.md](港股员工数据获取说明.md)

### Q2: 港股和 A 股有什么区别？
A: 主要区别：
- 数据单位：港股为港币，A 股为人民币
- 代码格式：港股为 5 位数字，A 股为 6 位数字+后缀
- 接口不同：使用不同的 AKShare 接口

详细说明请参考：[港股财务分析实现总结.md](港股财务分析实现总结.md)

### Q3: 如何下载年报 PDF？
A: 使用 `08_下载年报PDF.py` 脚本，或参考相关文档。

### Q4: 如何下载财务报表？
A: 推荐使用统一财务工具：
1. 运行 `启动统一财务工具.bat`
2. 选择市场（A 股/港股）
3. 选择功能"报表下载"
4. 输入股票代码和年份范围
5. 点击"开始下载"
6. 可以在页面上按年份和报表类型预览，也可以直接下载 Excel

**功能特点**：
- ✅ 支持实时预览，无需下载即可查看
- ✅ 港股报表显示中文科目名称
- ✅ 港股金额统一为亿元单位
- ✅ 数据持久化，切换预览不会丢失数据

财务报表下载工具可以下载三大报表（资产负债表、利润表、现金流量表），按年份组织成 Excel 文件。

## 📞 技术支持

- **问题反馈**：查看相关文档或代码注释
- **功能建议**：欢迎提出改进建议

## 📚 参考资料

- [AKShare 官方文档](https://akshare.akfamily.xyz/)
- [AKShare GitHub](https://github.com/akfamily/akshare)
- [Streamlit 官方文档](https://docs.streamlit.io/)

## 📝 更新日志

### 2025-12-15 更新

#### 🎉 新增功能
- ✅ **统一财务工具**：集成 A 股和港股财务分析、报表下载、员工数量提取的一站式界面
- ✅ **报表预览功能**：支持按年份和报表类型（资产负债表/利润表/现金流量表）实时预览
- ✅ **港股报表改进**：
  - 金额统一为亿元单位（港币），便于分析对比
  - 显示中文科目名称，提升可读性
  - 与 Excel 导出格式保持一致

#### 🔧 功能优化
- ✅ 修复港股报表预览数据丢失问题（使用 session_state 持久化）
- ✅ A 股报表下载也支持预览功能
- ✅ 优化报表科目显示顺序（利润表和现金流量表按标准顺序排列）
- ✅ 改进错误处理和数据转换逻辑

### 历史功能
- ✅ 支持港股完整财务分析（9 个 Sheet）
- ✅ 港股 Web 交互界面
- ✅ 财务报表下载工具（三大报表下载）
- ✅ 从年报 PDF 提取员工数量
- ✅ 港股员工数据获取
- ✅ 完整的文档体系

---

**版本**：2.1  
**最后更新**：2025-12-15

