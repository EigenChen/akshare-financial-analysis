# 企业财务对比 - 界面设计

## 界面布局

```
┌─────────────────────────────────────────────────────────────────────┐
│  企业财务对比分析                                                     │
├──────────────────────┬──────────────────────────────────────────────┤
│                      │                                               │
│  【左侧：条件输入】   │  【右侧：对比结果展示】                        │
│                      │                                               │
│  ┌────────────────┐ │  ┌─────────────────────────────────────────┐ │
│  │ 📅 年份选择     │ │  │ 📊 对比结果                              │ │
│  │ [2024 ▼]       │ │  │                                          │ │
│  └────────────────┘ │  │  ┌─────────────────────────────────────┐ │
│                      │  │  │ 📈 科目1: 营业收入（亿元）           │ │
│  ┌────────────────┐ │  │  │                                    │ │
│  │ 📁 文件选择    │ │  │  │  [柱状图]                           │ │
│  │ [选择Excel文件]│ │  │  │  企业A: 1000                        │ │
│  │ [+ 添加文件]   │ │  │  │  企业B: 800                         │ │
│  └────────────────┘ │  │  │  企业C: 1200                        │ │
│                      │  │  └─────────────────────────────────────┘ │
│  ┌────────────────┐ │  │                                          │
│  │ ✅ 已选企业    │ │  │  ┌─────────────────────────────────────┐ │
│  │ • 企业A.xlsx  │ │  │  │ 📈 科目2: 人均收入（万元）           │ │
│  │ • 企业B.xlsx  │ │  │  │                                    │ │
│  │ • 企业C.xlsx  │ │  │  │  [柱状图]                           │ │
│  │ [清除全部]    │ │  │  │  企业A: 50                          │ │
│  └────────────────┘ │  │  │  企业B: 45                         │ │
│                      │  │  │  企业C: 60                          │ │
│  ┌────────────────┐ │  │  └─────────────────────────────────────┘ │
│  │ 📋 科目选择    │ │  │                                          │
│  │                │ │  │  ┌─────────────────────────────────────┐ │
│  │ Sheet: [营收基本数据▼]│ │  │ 📈 科目3: 人均固定资产（万元）     │ │
│  │ ☑ 营业收入（亿元）│ │  │  │                                    │ │
│  │ ☑ 归母净利润（亿元）│ │  │  │  [柱状图]                         │ │
│  │ ☐ 经营利润（亿元）│ │  │  │  企业A: 20                          │ │
│  │                │ │  │  │  企业B: 18                           │ │
│  │ Sheet: [人均数据▼]│ │  │  │  企业C: 25                          │ │
│  │ ☑ 人均收入（万元）│ │  │  └─────────────────────────────────────┘ │
│  │ ☑ 人均固定资产（万元）│ │  │                                          │
│  │ ☐ 人均薪酬（万元）│ │  │  ... (更多科目)                       │
│  │                │ │  │                                          │
│  │ [展开全部Sheet]│ │  │                                          │
│  └────────────────┘ │  │                                          │
│                      │  │                                          │
│  ┌────────────────┐ │  │                                          │
│  │ [🚀 开始对比] │ │  │                                          │
│  └────────────────┘ │  │                                          │
│                      │  │                                          │
└──────────────────────┴──────────────────────────────────────────────┘
```

## 功能说明

### 左侧条件输入区

#### 1. 年份选择
- **控件**：下拉选择框（number_input 或 selectbox）
- **默认值**：当前年份或最近一年
- **说明**：选择要对比的年份，所有企业都使用同一年的数据

#### 2. 文件选择
- **控件**：文件上传器（file_uploader，支持多选）
- **功能**：
  - 可以多次上传文件
  - 显示已上传的文件列表
  - 支持删除已选文件
  - 从文件名或Excel内容中提取企业名称

#### 3. 已选企业显示
- **显示格式**：列表形式，显示文件名或企业名称
- **操作**：可以单独删除某个企业，或清除全部

#### 4. 科目选择
- **结构**：两级选择
  - **第一级**：Sheet名称（可展开/折叠）
    - 营收基本数据
    - 费用构成
    - 增长率
    - 资产负债
    - WC分析
    - 固定资产投入分析
    - 收益率和杜邦分析
    - 资产周转
    - 人均数据
  - **第二级**：该Sheet下的所有科目（复选框）
- **交互**：
  - 默认折叠所有Sheet
  - 点击Sheet名称展开/折叠
  - 可以全选/取消全选某个Sheet的所有科目
  - 显示已选科目数量

#### 5. 开始对比按钮
- **位置**：底部
- **样式**：主要按钮（primary）
- **功能**：点击后开始处理数据并显示结果

### 右侧结果展示区

#### 显示内容
- **按科目分组**：每个选中的科目显示一个独立的图表区域
- **图表类型**：柱状图（bar chart）
  - **横坐标（X轴）**：企业名称
  - **纵坐标（Y轴）**：科目数值
  - **图例**：显示具体数值
- **布局**：垂直排列，每个科目一个图表区域
- **交互**：
  - 图表可缩放
  - 鼠标悬停显示详细数值
  - 支持下载图表（可选）

## 数据处理逻辑

1. **文件解析**：
   - 读取每个Excel文件
   - 验证是否为财务分析Excel格式
   - 提取企业名称（从文件名或Excel内容）

2. **数据提取**：
   - 根据选择的年份，从每个Excel的对应Sheet中提取指定科目的数值
   - 如果某个企业缺少某个Sheet或科目，显示为0或"-"

3. **数据对比**：
   - 按科目分组
   - 每个科目生成一个对比图表
   - 横坐标：企业名称
   - 纵坐标：该科目的数值

## 界面交互流程

1. 用户选择年份
2. 用户上传一个或多个财务分析Excel文件
3. 系统显示已选企业列表
4. 用户展开Sheet，选择要对比的科目（可多选）
5. 点击"开始对比"按钮
6. 系统读取所有Excel文件，提取数据
7. 按科目分组显示柱状图对比结果

## 技术实现要点

- **文件上传**：使用 `st.file_uploader` 的 `accept_multiple_files=True`
- **科目选择**：使用 `st.expander` 实现可折叠的Sheet列表，内部使用 `st.checkbox`
- **图表绘制**：使用 `plotly.express.bar` 或 `plotly.graph_objects.Bar`
- **数据验证**：验证Excel文件格式，确保是财务分析Excel
- **错误处理**：处理文件读取失败、数据缺失等情况

## 示例数据展示

假设选择了3个企业（A、B、C），年份2024，选择了2个科目：
- 营业收入（亿元）
- 人均收入（万元）

显示结果：
```
┌─────────────────────────────────────┐
│ 📈 营业收入（亿元）                   │
│                                      │
│  [柱状图]                            │
│  企业A: ████████████ 1000            │
│  企业B: ████████ 800                  │
│  企业C: ██████████████ 1200          │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 📈 人均收入（万元）                   │
│                                      │
│  [柱状图]                            │
│  企业A: ████████████ 50              │
│  企业B: ██████████ 45                │
│  企业C: ██████████████ 60            │
└─────────────────────────────────────┘
```

---

## 确认问题

请确认以下理解是否正确：

1. ✅ 界面布局：左右分栏，左侧条件输入，右侧结果展示
2. ✅ 年份选择：单选，所有企业使用同一年份数据
3. ✅ 文件选择：支持多选，显示已选企业列表
4. ✅ 科目选择：两级结构（Sheet -> 科目），可多选
5. ✅ 结果展示：按科目分组，每个科目一个柱状图
6. ✅ 图表格式：横坐标=企业，纵坐标=数值

如有需要调整的地方，请告知！
