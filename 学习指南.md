# AKShare 学习指南 - 获取上市公司年报数据

## 一、AKShare 基础概念

### 1.1 什么是 AKShare？
AKShare 是一个开源的 Python 财经数据接口库，提供了丰富的金融数据获取接口，包括：
- 股票数据（实时行情、历史数据、财务数据等）
- 基金数据
- 期货数据
- 宏观经济数据
- 等等

### 1.2 数据来源
- 所有数据来自公开数据源
- 不涉及个人隐私和非公开数据
- 主要用于学术研究

### 1.3 安装和验证
```bash
pip install akshare
python 01_基础学习_验证安装.py
```

## 二、核心概念理解

### 2.1 股票代码格式
- **A股代码格式**：通常是6位数字，如 `000001`（平安银行）
- **带交易所后缀**：有些接口需要 `000001.SZ`（深交所）或 `600519.SH`（上交所）
- **代码获取**：使用 `ak.stock_info_a_code_name()` 获取所有A股代码

### 2.2 报告期概念
- **年报**：每年12月31日的财务报告
- **季报**：每季度末的财务报告（3月31日、6月30日、9月30日、12月31日）
- **筛选年报**：通常筛选包含 `12-31` 或 `年报` 的报告期

### 2.3 三大财务报表
1. **资产负债表**：反映公司在特定时点的财务状况
2. **利润表**：反映公司在一定期间的经营成果
3. **现金流量表**：反映公司在一定期间的现金流入流出情况

## 三、常用接口说明

### 3.1 获取股票列表
```python
import akshare as ak

# 获取所有A股代码和名称
stock_list = ak.stock_info_a_code_name()
```

### 3.2 获取财务指标
```python
# 获取财务分析指标
financial_data = ak.stock_financial_analysis_indicator(symbol="000001")
```

### 3.3 获取三大报表
```python
# 资产负债表
balance_sheet = ak.stock_balance_sheet_by_report_em(symbol="000001")

# 利润表
profit = ak.stock_profit_sheet_by_report_em(symbol="000001")

# 现金流量表
cash_flow = ak.stock_cash_flow_sheet_by_report_em(symbol="000001")
```

### 3.4 筛选年报数据
```python
# 假设数据中有"报告期"列
annual_data = data[data['报告期'].str.contains('12-31', na=False)]
```

## 四、学习路径

### 阶段1：基础验证（01_基础学习_验证安装.py）
- 验证 AKShare 是否正确安装
- 测试基本的数据获取功能
- 了解返回数据的格式

### 阶段2：获取股票列表（02_基础学习_获取股票列表.py）
- 学习如何获取所有A股股票
- 学习如何搜索特定股票
- 了解股票代码格式

### 阶段3：获取财务数据（03_基础学习_获取财务数据.py）
- 学习获取财务指标
- 学习获取三大财务报表
- 了解不同接口的返回格式

### 阶段4：专门获取年报（04_基础学习_获取年报数据.py）
- 学习如何筛选年报数据
- 学习获取历年年报数据
- 了解年报数据的结构

### 阶段5：实战应用（05_实战_年报数据收集.py）
- 学习批量获取多只股票数据
- 学习数据保存和组织
- 学习错误处理和延时控制

## 五、重要注意事项

### 5.1 请求频率控制
- **必须添加延时**：避免请求过快被限制
- **建议延时**：每次请求间隔 1-3 秒
- **批量处理**：使用 `time.sleep()` 控制频率

```python
import time

for symbol in symbols:
    get_data(symbol)
    time.sleep(2)  # 延时2秒
```

### 5.2 错误处理
- 网络请求可能失败，需要 try-except
- 某些股票可能没有数据，需要判断空值
- 不同接口的参数格式可能不同

### 5.3 数据格式
- 返回的数据通常是 pandas DataFrame
- 列名可能是中文，需要注意编码
- 保存CSV时使用 `encoding='utf-8-sig'` 避免乱码

### 5.4 数据更新
- 财务数据通常有延迟（年报通常在次年3-4月发布）
- 建议定期更新数据
- 注意数据的时间范围

## 六、常见问题

### Q1: 如何知道某个股票代码是否存在？
A: 使用 `ak.stock_info_a_code_name()` 获取所有股票列表，然后搜索。

### Q2: 如何获取特定年份的年报？
A: 先获取所有数据，然后根据报告期筛选。年报通常在12月31日。

### Q3: 接口返回的数据格式不一致怎么办？
A: 先打印数据结构（`df.columns`、`df.head()`），然后根据实际情况调整代码。

### Q4: 获取数据时出错怎么办？
A: 
1. 检查网络连接
2. 检查股票代码格式
3. 查看错误信息，可能需要调整参数
4. 某些接口可能需要更新，查看 AKShare 最新文档

### Q5: 如何批量获取大量股票数据？
A: 
1. 使用循环遍历股票列表
2. 添加适当的延时
3. 保存中间结果，避免重复获取
4. 处理异常，记录失败的股票

## 七、下一步：构建估值模型

完成基础学习后，我们可以：
1. **数据收集**：批量获取目标股票的年报数据
2. **数据清洗**：统一数据格式，处理缺失值
3. **指标计算**：计算估值相关的财务指标
4. **业务分析**：分析业务驱动力
5. **估值模型**：构建估值分析表格

## 八、参考资料

- [AKShare 官方文档](https://akshare.akfamily.xyz/)
- [AKShare GitHub](https://github.com/akfamily/akshare)
- [Pandas 文档](https://pandas.pydata.org/docs/)

---

**提示**：建议按照 01-05 的顺序逐步学习，每完成一个脚本，理解其功能后再进行下一个。

