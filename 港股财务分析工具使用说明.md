# 港股财务分析工具使用说明

## 📋 概述

港股财务分析工具是一个基于Streamlit的Web界面应用，用于分析港股上市公司的财务数据，生成完整的9个财务分析sheet。

## 🚀 快速开始

### 方法1：使用批处理文件启动（推荐）

1. 双击 `启动港股应用.bat` 文件
2. 浏览器会自动打开应用界面（通常是 `http://localhost:8501`）

### 方法2：使用命令行启动

```bash
streamlit run streamlit_app_hk.py
```

## 💡 功能特点

1. **完整的财务分析**：生成9个财务分析sheet
   - 营收基本数据
   - 费用构成
   - 增长率
   - 资产负债
   - WC分析
   - 固定资产投入分析
   - 收益率和杜邦分析
   - 资产周转
   - 人均数据（可能因无法获取员工人数而显示为"-"）

2. **交互式界面**：
   - 港股代码输入和验证
   - 年份范围选择
   - 分析模块选择
   - 实时进度显示

3. **数据可视化**：
   - 数据表格展示
   - 趋势图表（双Y轴折线图）
   - 支持多指标对比

4. **结果管理**：
   - Excel文件下载
   - 加载已有结果文件
   - 公式说明

## 📝 使用步骤

### 新建分析

1. **选择分析模式**：在侧边栏选择 "🆕 新建分析"

2. **输入港股代码**：
   - 输入5位港股代码，如：`00700`（腾讯控股）
   - 系统会自动验证代码格式并显示公司名称
   - 支持的代码示例：
     - `00700` - 腾讯控股
     - `03690` - 美团
     - `09988` - 阿里巴巴-SW
     - `01810` - 小米集团-W

3. **选择年份范围**：
   - 起始年份：选择分析的起始年份
   - 结束年份：选择分析的结束年份
   - 注意：起始年份不能大于结束年份

4. **选择分析模块**：
   - 勾选需要分析的项目（默认全选）
   - 可以取消不需要的模块以加快分析速度

5. **开始分析**：
   - 点击 "🚀 开始分析" 按钮
   - 等待分析完成（会显示进度条）

6. **查看结果**：
   - 在结果区域选择要查看的Sheet
   - 查看数据表格
   - 查看趋势图表
   - 查看公式说明

7. **下载Excel文件**：
   - 点击 "📥 下载Excel文件" 按钮
   - 文件会保存到 `output` 目录

### 加载已有结果

1. **选择分析模式**：在侧边栏选择 "📂 加载已有结果"

2. **上传Excel文件**：
   - 点击文件上传区域
   - 选择之前生成的港股财务分析Excel文件
   - 系统会自动解析文件信息

3. **查看结果**：
   - 选择要查看的Sheet
   - 查看数据表格和图表
   - 可以重新下载文件

## 📊 数据说明

### 货币单位

- **所有金额数据单位为：港币（HKD）**
- **不进行货币转换**：保持原始港币单位
- 金额单位：亿元
- 百分比：直接显示百分比数值（如28.12表示28.12%）

### 数据来源

- 数据来源：AKShare港股财务报表接口
- 接口：
  - `stock_financial_hk_report_em` - 港股三大报表（利润表、资产负债表、现金流量表）
  - `stock_financial_hk_analysis_indicator_em` - 港股财务分析指标

### 数据格式

- 港股接口返回的是长格式数据（每个科目一行）
- 系统会自动转换为宽格式（每个科目一列）
- 中文科目名会自动映射为A股英文字段名

## ⚠️ 注意事项

1. **港股代码格式**：
   - 必须是5位数字
   - 不需要添加交易所后缀（如`.HK`）
   - 系统会自动验证代码格式

2. **数据可用性**：
   - 部分字段可能因数据源限制而显示为"-"
   - 人均数据通常无法获取（因缺少员工人数数据）
   - 某些费用明细可能不完整

3. **网络连接**：
   - 需要稳定的网络连接以获取数据
   - 如果数据获取失败，请检查网络连接或稍后重试

4. **年份范围**：
   - 建议选择合理的年份范围（如5-10年）
   - 年份范围过大可能导致数据获取时间较长

## 🔧 技术说明

### 文件结构

```
├── streamlit_app_hk.py          # 港股财务分析Streamlit应用
├── 启动港股应用.bat              # Windows启动脚本
├── hk_financial_adapter.py       # 港股适配层
├── hk_financial_analysis_full.py # 港股财务分析完整版
└── output/                       # 输出目录（Excel文件）
```

### 依赖模块

- `streamlit` - Web界面框架
- `pandas` - 数据处理
- `plotly` - 图表绘制
- `akshare` - 港股数据获取
- `openpyxl` - Excel文件操作

### 数据流程

1. **数据获取**：通过AKShare接口获取港股三大报表数据
2. **格式转换**：将长格式数据转换为宽格式
3. **字段映射**：将中文科目名映射为A股英文字段名
4. **计算分析**：复用A股计算逻辑（字段名已统一）
5. **结果展示**：在Web界面展示和下载

## 📚 相关文档

- `港股财务分析实现总结.md` - 详细实现说明
- `港股财务分析说明.md` - 港股接口说明
- `STREAMLIT_使用说明.md` - Streamlit使用说明（A股版本）

## 🐛 常见问题

### Q1: 为什么某些字段显示为"-"？

A: 可能的原因：
- 数据源中该字段不存在
- 该字段在港股报表中的名称不同，未映射成功
- 该年份的数据缺失

### Q2: 人均数据为什么都是"-"？

A: 港股接口无法直接获取员工人数数据，需要手动提供员工数量CSV文件（当前版本暂不支持）。

### Q3: 分析速度慢怎么办？

A: 可以：
- 减少分析的年份范围
- 取消不需要的分析模块
- 检查网络连接速度

### Q4: 如何查看公式说明？

A: 在结果展示区域，点击 "📝 公式说明" 展开按钮即可查看。

## 📞 技术支持

如有问题或建议，请查看：
- 代码注释
- 相关文档
- GitHub Issues（如果有）

---

**版本**：1.0  
**更新日期**：2025-12-15  
**货币单位**：港币（HKD）

