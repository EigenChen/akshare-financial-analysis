# 港股财务分析说明

## 概述

AKShare 支持获取港股财务报表数据，但接口和数据结构与A股有所不同。本文档说明如何使用AKShare获取港股数据并生成类似的9个sheet。

## AKShare港股财务报表接口

根据AKShare的接口列表，港股相关的财务报表接口包括：

### 1. 港股财务报表接口

- **`stock_financial_hk_report_em`** - 港股财务报表（可能包含资产负债表）
- **`stock_financial_hk_profit_em`** - 港股利润表（需要验证）
- **`stock_financial_hk_cashflow_em`** - 港股现金流量表（需要验证）

### 2. 其他港股相关接口

- **`stock_financial_hk_analysis_indicator_em`** - 港股财务分析指标
- **`stock_financial_hk_financial_indicator_em`** - 港股财务指标
- **`stock_hk_company_profile_em`** - 港股公司概况

## 港股代码格式

港股代码格式通常为5位数字，例如：
- `00700` - 腾讯控股
- `03690` - 美团
- `09988` - 阿里巴巴-SW

**注意**：港股代码不需要添加交易所后缀（如`.HK`），直接使用5位数字代码即可。

## 实现方案

### 方案1：直接使用港股接口（推荐）

如果AKShare的港股接口返回的数据结构与A股类似，可以创建适配函数：

```python
def get_hk_annual_data(symbol, start_year=2015, end_year=2024):
    """
    获取港股指定年份范围的年报数据
    
    参数:
        symbol: 港股代码（5位数字，如 "00700"）
        start_year: 起始年份
        end_year: 结束年份
    
    返回:
        包含利润表、现金流量表、资产负债表数据的字典
    """
    results = {
        'profit': None,
        'cash_flow': None,
        'balance_sheet': None
    }
    
    try:
        # 获取利润表
        print("正在获取港股利润表数据...")
        profit = ak.stock_financial_hk_profit_em(symbol=symbol)
        if profit is not None and not profit.empty:
            results['profit'] = profit
            print(f"✓ 利润表数据获取成功，共 {len(profit)} 条记录")
        
        # 获取现金流量表
        print("正在获取港股现金流量表数据...")
        cash_flow = ak.stock_financial_hk_cashflow_em(symbol=symbol)
        if cash_flow is not None and not cash_flow.empty:
            results['cash_flow'] = cash_flow
            print(f"✓ 现金流量表数据获取成功，共 {len(cash_flow)} 条记录")
        
        # 获取资产负债表
        print("正在获取港股资产负债表数据...")
        balance_sheet = ak.stock_financial_hk_report_em(symbol=symbol)
        if balance_sheet is not None and not balance_sheet.empty:
            results['balance_sheet'] = balance_sheet
            print(f"✓ 资产负债表数据获取成功，共 {len(balance_sheet)} 条记录")
        
    except Exception as e:
        print(f"✗ 获取数据失败: {e}")
        import traceback
        traceback.print_exc()
    
    return results
```

### 方案2：字段映射适配

港股财务报表的字段名可能与A股不同，需要创建字段映射：

```python
# 港股字段映射（需要根据实际返回数据调整）
HK_FIELD_MAPPING = {
    # 利润表字段
    'OPERATE_INCOME': '营业收入',  # 可能需要根据实际字段名调整
    'PARENT_NETPROFIT': '归母净利润',
    'DEDUCT_PARENT_NETPROFIT': '扣非净利润',
    
    # 资产负债表字段
    'TOTAL_ASSETS': '总资产',
    'TOTAL_CURRENT_ASSETS': '流动资产合计',
    'TOTAL_NONCURRENT_ASSETS': '非流动资产合计',
    # ... 其他字段映射
}
```

### 方案3：统一接口封装

创建一个统一的接口，自动识别A股或港股：

```python
def get_annual_data_unified(symbol, start_year=2015, end_year=2024):
    """
    统一接口：自动识别A股或港股并获取数据
    
    参数:
        symbol: 股票代码
            - A股：6位数字，如 "600519" 或 "600519.SH"
            - 港股：5位数字，如 "00700"
    """
    # 判断是A股还是港股
    symbol_clean = symbol.replace('.SZ', '').replace('.SH', '').replace('.HK', '')
    
    if len(symbol_clean) == 6:
        # A股
        return get_a_stock_annual_data(symbol, start_year, end_year)
    elif len(symbol_clean) == 5:
        # 港股
        return get_hk_annual_data(symbol_clean, start_year, end_year)
    else:
        raise ValueError(f"不支持的股票代码格式: {symbol}")
```

## 注意事项

### 1. 数据字段差异

港股财务报表的字段名可能与A股不同，需要：
- 先测试接口返回的实际字段名
- 创建字段映射表
- 调整数据提取逻辑

### 2. 数据单位

- 港股数据可能使用港币（HKD）作为单位
- A股数据使用人民币（CNY）作为单位
- 需要统一单位或进行汇率转换

### 3. 报告期格式

- 港股报告期格式可能与A股不同
- 需要调整日期解析逻辑

### 4. 数据完整性

- 港股某些字段可能缺失
- 需要增加数据缺失处理逻辑

## 实施步骤

### 步骤1：测试港股接口

```python
import akshare as ak

# 测试港股接口
symbol = "00700"  # 腾讯控股

# 测试各个接口
try:
    # 测试财务报表接口
    report = ak.stock_financial_hk_report_em(symbol=symbol)
    print("财务报表接口:")
    print(report.columns.tolist())
    print(report.head())
    
    # 测试利润表接口（如果存在）
    # profit = ak.stock_financial_hk_profit_em(symbol=symbol)
    
    # 测试现金流量表接口（如果存在）
    # cashflow = ak.stock_financial_hk_cashflow_em(symbol=symbol)
    
except Exception as e:
    print(f"接口测试失败: {e}")
```

### 步骤2：分析数据结构

- 查看返回数据的列名
- 确认字段对应关系
- 检查数据格式和单位

### 步骤3：创建适配层

- 创建港股数据获取函数
- 实现字段映射
- 统一数据格式

### 步骤4：复用现有计算逻辑

- 大部分计算逻辑可以复用
- 只需要调整数据获取部分
- 字段映射后可直接使用现有函数

## 9个Sheet生成

一旦数据获取和字段映射完成，可以复用现有的9个sheet生成逻辑：

1. **营收基本数据** - 复用 `calculate_revenue_metrics`
2. **费用构成** - 复用 `calculate_expense_metrics`
3. **增长** - 复用 `calculate_growth_metrics`
4. **资产负债** - 复用 `calculate_balance_sheet_metrics`
5. **WC分析** - 复用 `calculate_wc_metrics`
6. **固定资产投入分析** - 复用 `calculate_fixed_asset_metrics`
7. **收益率和杜邦分析** - 复用 `calculate_roi_metrics`
8. **资产周转** - 复用 `calculate_asset_turnover_metrics`
9. **人均数据** - 复用 `calculate_per_capita_metrics`

## 验证建议

1. **先测试单个港股**：选择一只知名港股（如腾讯控股00700）进行完整测试
2. **对比数据准确性**：与官方财报数据对比，确保计算正确
3. **处理边界情况**：测试数据缺失、异常值等情况
4. **性能测试**：测试批量处理多只港股的性能

## 参考资源

- [AKShare官方文档](https://akshare.akfamily.xyz/)
- [AKShare GitHub](https://github.com/akfamily/akshare)
- 港股交易所官网（获取官方财报数据用于验证）

## 总结

AKShare支持港股财务报表数据获取，但需要：

1. ✅ **验证接口可用性**：测试港股财务报表接口是否可用
2. ✅ **字段映射**：创建港股字段到A股字段的映射
3. ✅ **数据适配**：统一数据格式和单位
4. ✅ **复用逻辑**：大部分计算逻辑可以直接复用

建议先进行小规模测试，验证数据获取和字段映射的正确性，然后再扩展到完整的9个sheet生成功能。

