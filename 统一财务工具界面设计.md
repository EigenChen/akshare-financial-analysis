# 统一财务工具界面设计

## 📐 界面布局设计

### 整体结构

```
┌─────────────────────────────────────────────────────────┐
│  标题栏：财务分析工具（A股+港股）                          │
│  说明：整合财务分析、报表下载、员工数量提取三大功能          │
└─────────────────────────────────────────────────────────┘

┌──────────────┬──────────────────────────────────────────┐
│              │                                           │
│   侧边栏     │           主内容区                         │
│              │                                           │
│ ┌──────────┐ │  ┌────────────────────────────────────┐ │
│ │市场选择  │ │  │  根据选择的功能显示：                │ │
│ │○ A股     │ │  │  - 财务分析：9个Sheet结果展示       │ │
│ │○ 港股    │ │  │  - 报表下载：三大报表Excel下载      │ │
│ └──────────┘ │  │  - 员工数量：CSV文件下载            │ │
│              │  └────────────────────────────────────┘ │
│ ┌──────────┐ │                                           │
│ │功能选择  │ │                                           │
│ │○ 财务分析│ │                                           │
│ │○ 报表下载│ │                                           │
│ │○ 员工数量│ │                                           │
│ └──────────┘ │                                           │
│              │                                           │
│ ┌──────────┐ │                                           │
│ │参数设置  │ │                                           │
│ │(动态显示)│ │                                           │
│ └──────────┘ │                                           │
│              │                                           │
│ ┌──────────┐ │                                           │
│ │执行按钮  │ │                                           │
│ └──────────┘ │                                           │
└──────────────┴──────────────────────────────────────────┘
```

## 🎨 详细设计

### 1. 页面标题和说明

**位置**：主内容区顶部

```
📊 财务分析工具（A股 + 港股）

💡 功能说明：
• 📈 财务分析：生成9个Sheet的完整财务分析报告
• 📄 报表下载：下载历年三大财务报表（资产负债表、利润表、现金流量表）
• 👥 员工数量：从年报PDF中提取历年员工数量数据

💰 数据单位：
• A股：人民币（CNY）
• 港股：港币（HKD），不进行货币转换
```

### 2. 侧边栏设计

#### 2.1 市场选择（第一层）

```
┌─────────────────────┐
│ 🌍 市场选择          │
├─────────────────────┤
│ ○ A股市场           │
│ ○ 港股市场          │
└─────────────────────┘
```

**说明**：
- 使用 `st.radio` 单选按钮
- 切换市场时，自动调整输入提示和验证逻辑
- A股：6位数字代码（如：603486）
- 港股：5位数字代码（如：00700）

#### 2.2 功能选择（第二层）

```
┌─────────────────────┐
│ 🛠️ 功能选择          │
├─────────────────────┤
│ ○ 📊 财务分析       │
│ ○ 📄 报表下载       │
│ ○ 👥 员工数量提取    │
└─────────────────────┘
```

**说明**：
- 使用 `st.radio` 单选按钮
- 切换功能时，动态显示对应的参数设置区域
- 每个功能有独立的参数配置

#### 2.3 参数设置（第三层，动态显示）

##### 功能1：财务分析

```
┌─────────────────────┐
│ ⚙️ 分析参数          │
├─────────────────────┤
│ 股票代码: [____]    │
│ 起始年份: [____]    │
│ 结束年份: [____]    │
│                     │
│ 📋 分析模块：        │
│ ☑ 营收基本数据      │
│ ☑ 费用构成          │
│ ☑ 增长率            │
│ ☑ 资产负债          │
│ ☑ WC分析            │
│ ☑ 固定资产投入分析   │
│ ☑ 收益率和杜邦分析   │
│ ☑ 资产周转          │
│ ☑ 人均数据          │
│                     │
│ 👥 员工数量CSV：     │
│ [上传文件]          │
│ (可选)              │
│                     │
│ [🚀 开始分析]        │
└─────────────────────┘
```

##### 功能2：报表下载

```
┌─────────────────────┐
│ ⚙️ 下载参数          │
├─────────────────────┤
│ 股票代码: [____]    │
│ 起始年份: [____]    │
│ 结束年份: [____]    │
│                     │
│ 📋 报表类型：        │
│ ☑ 资产负债表        │
│ ☑ 利润表            │
│ ☑ 现金流量表        │
│                     │
│ [🚀 开始下载]        │
└─────────────────────┘
```

##### 功能3：员工数量提取

```
┌─────────────────────┐
│ ⚙️ 提取参数          │
├─────────────────────┤
│ 股票代码: [____]    │
│ 起始年份: [____]    │
│ 结束年份: [____]    │
│                     │
│ 📁 PDF文件目录：     │
│ [选择目录]          │
│ 或                  │
│ [上传PDF文件]       │
│ (支持批量上传)      │
│                     │
│ [🚀 开始提取]        │
└─────────────────────┘
```

### 3. 主内容区设计

#### 3.1 财务分析结果展示

```
┌─────────────────────────────────────────┐
│ 📊 财务分析结果                          │
├─────────────────────────────────────────┤
│ 公司名称：XXX                            │
│ 分析年份：2020-2024                      │
│ 货币单位：人民币/港币                    │
├─────────────────────────────────────────┤
│                                         │
│ [选择Sheet ▼]                           │
│                                         │
│ ┌───────────────────────────────────┐ │
│ │ 数据表格                            │ │
│ │                                     │ │
│ └───────────────────────────────────┘ │
│                                         │
│ ┌───────────────────────────────────┐ │
│ │ 📈 趋势图表                         │ │
│ │                                     │ │
│ └───────────────────────────────────┘ │
│                                         │
│ [📥 下载Excel文件]                      │
└─────────────────────────────────────────┘
```

#### 3.2 报表下载结果展示

```
┌─────────────────────────────────────────┐
│ 📄 报表下载结果                          │
├─────────────────────────────────────────┤
│ 公司名称：XXX                            │
│ 下载年份：2020-2024                      │
│ 报表类型：三大报表                        │
├─────────────────────────────────────────┤
│                                         │
│ 下载进度：██████████ 100%                │
│                                         │
│ ✅ 已下载报表：                          │
│   • 2020年：资产负债表、利润表、现金流量表 │
│   • 2021年：资产负债表、利润表、现金流量表 │
│   • ...                                 │
│                                         │
│ [📥 下载Excel文件]                      │
└─────────────────────────────────────────┘
```

#### 3.3 员工数量提取结果展示

```
┌─────────────────────────────────────────┐
│ 👥 员工数量提取结果                       │
├─────────────────────────────────────────┤
│ 公司名称：XXX                            │
│ 提取年份：2020-2024                      │
├─────────────────────────────────────────┤
│                                         │
│ 提取进度：██████████ 100%                │
│                                         │
│ ✅ 提取结果：                            │
│   • 2020年：62,885 人                   │
│   • 2021年：68,226 人                   │
│   • 2022年：74,317 人                   │
│   • 2023年：106,836 人                  │
│   • 2024年：115,076 人                  │
│                                         │
│ ⚠️ 未找到数据：                          │
│   • 2021年：PDF文件不存在                │
│                                         │
│ [📥 下载CSV文件]                        │
└─────────────────────────────────────────┘
```

## 🔄 交互流程

### 流程1：财务分析

```
用户操作：
1. 选择市场（A股/港股）
2. 选择功能（财务分析）
3. 输入股票代码
4. 选择年份范围
5. 勾选分析模块
6. （可选）上传员工数量CSV
7. 点击"开始分析"

系统响应：
1. 验证输入参数
2. 显示进度条
3. 获取财务数据
4. 计算各项指标
5. 生成Excel文件
6. 显示结果表格和图表
7. 提供下载按钮
```

### 流程2：报表下载

```
用户操作：
1. 选择市场（A股/港股）
2. 选择功能（报表下载）
3. 输入股票代码
4. 选择年份范围
5. 勾选报表类型
6. 点击"开始下载"

系统响应：
1. 验证输入参数
2. 显示进度条
3. 按年份获取三大报表
4. 格式化数据
5. 生成Excel文件（每年一个Sheet）
6. 显示下载结果
7. 提供下载按钮
```

### 流程3：员工数量提取

```
用户操作：
1. 选择市场（A股/港股）
2. 选择功能（员工数量提取）
3. 输入股票代码
4. 选择年份范围
5. 选择PDF文件目录或上传PDF文件
6. 点击"开始提取"

系统响应：
1. 验证输入参数
2. 显示进度条
3. 遍历PDF文件
4. 提取员工数量
5. 生成CSV文件
6. 显示提取结果
7. 提供下载按钮
```

## 🎯 设计要点

### 1. 统一性
- 所有功能使用相同的侧边栏布局
- 统一的按钮样式和颜色
- 一致的结果展示格式

### 2. 动态性
- 根据市场选择动态调整输入提示
- 根据功能选择动态显示参数区域
- 根据市场类型调用不同的适配层

### 3. 用户体验
- 清晰的步骤指引
- 实时进度反馈
- 错误提示和帮助信息
- 结果预览和下载

### 4. 代码组织
- 使用函数封装每个功能的逻辑
- 统一的错误处理
- 模块化的组件设计

## 📝 技术实现要点

### 1. 状态管理
```python
# 使用 session_state 管理状态
st.session_state['market_type'] = 'A股'  # 或 '港股'
st.session_state['function_type'] = '财务分析'  # 或 '报表下载' 或 '员工数量'
st.session_state['symbol'] = ''
st.session_state['start_year'] = 2020
st.session_state['end_year'] = 2024
```

### 2. 条件渲染
```python
# 根据市场类型显示不同的输入提示
if market_type == 'A股':
    symbol_help = "请输入6位股票代码，如：603486"
    symbol_pattern = r'^\d{6}$'
else:  # 港股
    symbol_help = "请输入5位港股代码，如：00700"
    symbol_pattern = r'^\d{5}$'
```

### 3. 功能路由
```python
# 根据功能选择调用不同的处理函数
if function_type == '财务分析':
    handle_financial_analysis()
elif function_type == '报表下载':
    handle_report_download()
elif function_type == '员工数量':
    handle_employee_extraction()
```

## 🎨 UI/UX 优化建议

1. **颜色方案**：
   - A股：蓝色系
   - 港股：绿色系
   - 功能区分：使用图标和颜色

2. **响应式设计**：
   - 适配不同屏幕尺寸
   - 移动端友好

3. **加载状态**：
   - 使用进度条显示处理进度
   - 提供取消按钮（长时间操作）

4. **错误处理**：
   - 友好的错误提示
   - 提供解决方案建议

5. **帮助信息**：
   - 每个输入框都有帮助提示
   - 提供示例和文档链接

---

**设计完成日期**：2025-12-15  
**设计者**：AI Assistant  
**状态**：待实现

